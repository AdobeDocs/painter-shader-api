"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[1099],{10779:function(e,n,r){r.r(n),r.d(n,{_frontmatter:function(){return d},default:function(){return s}});var a=r(87462),t=r(63366),o=(r(15007),r(64983)),i=r(91515),m=["components"],d={},l={_frontmatter:d},p=i.Z;function s(e){var n=e.components,r=(0,t.Z)(e,m);return(0,o.mdx)(p,(0,a.Z)({},l,r,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"lib-envglsl"},"lib","-","env.glsl"),(0,o.mdx)("hr",null),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Public Functions:"),"\n",(0,o.mdx)("inlineCode",{parentName:"p"},"envSample"),"\n",(0,o.mdx)("inlineCode",{parentName:"p"},"envIrradiance"),"\n",(0,o.mdx)("inlineCode",{parentName:"p"},"worldToEnvSpace")),(0,o.mdx)("p",null,"Needed for math constants"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-glsl"},"import lib-defines.glsl\n")),(0,o.mdx)("p",null,"Engine provided parameters"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-glsl"},"//: param auto texture_environment\n uniform sampler2D environment_texture;\n //: param auto environment_matrix\n uniform mat3 environment_matrix;\n //: param auto environment_exposure\n uniform float environment_exposure;\n //: param auto environment_irrad_mat_red\n uniform mat4 irrad_mat_red;\n //: param auto environment_irrad_mat_green\n uniform mat4 irrad_mat_green;\n //: param auto environment_irrad_mat_blue\n uniform mat4 irrad_mat_blue;\n")),(0,o.mdx)("p",null,"Helper that allows one to sample environment. Rotation is taken into\naccount. The environment map is a panoramic env map behind the scene,\nthat's why there is extra computation from dir vector.\nDirection must be in environment space (using worldToEnvSpace function)"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-glsl"},"vec3 envSample(vec3 dir, float lod)\n {\n   // WORKAROUND: Intel GLSL compiler for HD5000 is bugged on OSX:\n   // https://bugs.chromium.org/p/chromium/issues/detail?id=308366\n   // It is necessary to replace atan(y, -x) by atan(y, -1.0 * x) to force\n   // the second parameter to be interpreted as a float\n   vec2 pos = M_INV_PI * vec2(atan(-dir.z, -1.0 * dir.x), 2.0 * asin(dir.y));\n   pos = 0.5 * pos + vec2(0.5);\n   return textureLod(environment_texture, pos, lod).rgb * environment_exposure;\n }\n")),(0,o.mdx)("p",null,"Transform a direction from world to environment space"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-glsl"},"vec3 worldToEnvSpace(vec3 dirW)\n {\n   return environment_matrix * dirW;\n }\n")),(0,o.mdx)("p",null,"Return the irradiance for a given direction. The computation is based on\nenvironment's spherical harmonics projection.\nDirection in world space"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-glsl"},"vec3 envIrradiance(vec3 dirW)\n {\n   vec4 shDir = vec4(worldToEnvSpace(dirW).xzy, 1.0);\n   return max(vec3(0.0), vec3(\n       dot(shDir, irrad_mat_red * shDir),\n       dot(shDir, irrad_mat_green * shDir),\n       dot(shDir, irrad_mat_blue * shDir)\n     )) * environment_exposure;\n }\n \n \n")))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-api-libraries-lib-env-md-cd09db1edba0d31d8b99.js.map